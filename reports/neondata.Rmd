---
title: "Investigating NEON data"
output: github_document
---

```{r setup, include=FALSE}
library(dplyr)
library(scads)
```

## Aquatic plants

```{r aquatic plants}

ap_path <- here::here("reports", "datasets", "neon", "aquatic_plants")
ap_path <- file.path(ap_path, list.dirs(ap_path, full.names = FALSE, recursive = F)[ which(nchar(list.dirs(ap_path, full.names = FALSE, recursive = F)) > 2)]) 
vars <- read.csv(file.path(ap_path, "stackedFiles", "variables.csv"), stringsAsFactors = F)
pointTrans <- read.csv(file.path(ap_path, "stackedFiles", "apc_pointTransect.csv"), stringsAsFactors = F)
perTaxon <- read.csv(file.path(ap_path, "stackedFiles", "apc_perTaxon.csv"), stringsAsFactors = F)


goodSamples <- pointTrans %>%
  filter(is.na(samplingImpractical),
         is.na(dataQF),
         targetTaxaPresent == "Y")

perTaxonPropSpecies <- perTaxon %>%
  filter(eventID %in% goodSamples$eventID) %>%
  select(siteID, namedLocation, eventID, taxonID, class, order, family, genus, specificEpithet) %>%
  group_by(siteID,eventID, namedLocation, taxonID, class, order, family, genus) %>%
  summarize(nobs = n(),
            nspp = sum((specificEpithet == "sp."))) %>%
  ungroup()

```

I'm not really convinced the aquatic plant data is appropriate. This is because 
* It appears to be point presence/absence at points in a transect, which are often low and not really abundance counts
* A lot of the taxa are nonspecific, like "PLANT2". Also, things are often not identified to species (specificEpithet = "sp."), and I'm not sure how to differentiate between different unknown species in the same genus. 

It might be fine! But I'm not confident in it after a little bit of poking. 

```{r clean up aquatic plants}

rm(ap_path)
rm(vars)
rm(pointTrans)
rm(perTaxon)
rm(goodSamples) 
rm(perTaxonPropSpecies)

```


## Ground beetles
```{r download and stack ground beetles, eval = F}

download_neon_data("ground_beetles")

```

bet_sorting.csv is the raw-est beetles data. There is a complicated process for getting additional species identifications. Before I go too deep into that, I'm wondering what the diversity & abundance more-or-less look like here. 

```{r load and look at ground beetles}
gb_path <- here::here("reports", "datasets", "neon", "ground_beetles")
gb_path <- file.path(gb_path, list.dirs(gb_path, full.names = FALSE, recursive = F)[ which(nchar(list.dirs(gb_path, full.names = FALSE, recursive = F)) > 2)]) 

vars <- read.csv(file.path(gb_path, "stackedFiles", "variables.csv"), stringsAsFactors = F)
bet_sort <- read.csv(file.path(gb_path, "stackedFiles", "bet_sorting.csv"), stringsAsFactors = F)

bet_sort_statevars <- bet_sort %>%
  filter(sampleType == "carabid") %>%
  group_by(plotID) %>%
  summarize(nspp = length(unique(taxonID)),
            nind = sum(individualCount)) %>%
  ungroup()

```
